<?php 
	//error_reporting(E_ERROR | E_WARNING | E_PARSE);
	error_reporting(E_ALL);
	date_default_timezone_set('UTC');
	clearstatcache(true);

	include_once( __DIR__ . '/../trade/__bootstrap.php');
	include_once( __DIR__ . '/../trade/__authconfig.php');
	
	//use Hybridauth\Hybridauth;
	
	//$hybridauth = new Hybridauth($config);
	//$adapters = $hybridauth->getConnectedAdapters();
	
?>
<!DOCTYPE html>
<html>
    <head>
        
        <!-- Title -->
        <title>IDXT | IndexTrade Login - Sign in</title>
        
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <meta charset="UTF-8">
        <meta name="description" content="IDXT | IndexTrade.Exchange" />
        <meta name="keywords" content="bitcoin,exchange,index,indextrade,trading,cryptocurrency" />
        <meta name="author" content="CoinIndex Ltd. <info@coinindex.agency>" />
        
        <!-- Styles -->
        <link href='//fonts.googleapis.com/css?family=Ubuntu:300,400,500,700' rel='stylesheet' type='text/css'>
        <link href="//static.indextrade.exchange/plugins/pace-master/themes/blue/pace-theme-flash.css" rel="stylesheet"/>
        <link href="//static.indextrade.exchange/plugins/uniform/css/uniform.default.min.css" rel="stylesheet"/>
        <link href="//static.indextrade.exchange/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="//static.indextrade.exchange/plugins/fontawesome/css/font-awesome.css" rel="stylesheet" type="text/css"/>
        <link href="//static.indextrade.exchange/plugins/line-icons/simple-line-icons.css" rel="stylesheet" type="text/css"/>	
        <link href="//static.indextrade.exchange/plugins/waves/waves.min.css" rel="stylesheet" type="text/css"/>	
        <link href="//static.indextrade.exchange/plugins/switchery/switchery.min.css" rel="stylesheet" type="text/css"/>
        <link href="//static.indextrade.exchange/plugins/3d-bold-navigation/css/style.css" rel="stylesheet" type="text/css"/>	
        <link href="//static.indextrade.exchange/plugins/toastr/toastr.min.css" rel="stylesheet" type="text/css"/>
		
        <!-- Theme Styles -->
        <link href="//static.indextrade.exchange/css/modern.min.css" rel="stylesheet" type="text/css"/>
        <link href="//static.indextrade.exchange/css/custom.css" rel="stylesheet" type="text/css"/>
        
        <script src="//static.indextrade.exchange/plugins/3d-bold-navigation/js/modernizr.js"></script>
        
        
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
		<script>
		
			function auth_popup( provider ){
				// replace 'path/to/hybridauth' with the real path to this script
				var authWindow = window.open('callback.html?provider='+provider, 'authWindow', 'width=600,height=400,scrollbars=yes');
				return false;
			}
		
		</script>
        
    </head>
    <body class="page-login login-alt">
        <main class="page-content">
            <div class="page-inner">
                <div id="main-wrapper">
                    <div class="row">
                        <div class="col-md-8 center">
                            <div class="login-box panel panel-white">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <!--
											<a href="index.html" class="logo-name text-lg">IndexTrade</a>
                                            <p class="m-t-md">Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet.<br> Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet. </p>
											-->
											<p class="m-t-md">
												<div>
													<a href="index.html" class="logo-name text-lg">
														<img src="logo.png" align="absmiddle" style="width:100%;border:0px;" />
													</a>
												</div>
											</p>
											
											
											
                                            <div class="btn-group btn-group-justified m-t-sm" role="group" aria-label="Justified button group">
                                                <a href="javascript:auth_popup('Facebook');" class="btn btn-facebook"><i class="fa fa-facebook"></i> Facebook</a>
                                                <a href="javascript:auth_popup('Twitter');" class="btn btn-twitter"><i class="fa fa-twitter"></i> Twitter</a>
                                                <a href="javascript:auth_popup('Google');" class="btn btn-google"><i class="fa fa-google-plus"></i> Google+</a>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <?php 
												if (!empty($_REQUEST['error'])){													
													echo '<div class="alert alert-danger" role="alert"><b>Error</b>: ' . $_REQUEST['error'] . '</div>';
												}
											?>
											<form action="https://trade.indextrade.exchange/user/auth" method="POST" class="idxtForm">
                                                <div class="form-group">
                                                    <input type="email" id="email" name="email" value="test@test.com" class="form-control idxtRegisterEmail" placeholder="Email" required>
                                                </div>
                                                <div class="form-group">
                                                    <input type="password" id="passw" name="passw" value="test" class="form-control idxtRegisterPassword" placeholder="Password" required>
                                                </div>
                                                
												<a href="#" class="btn btn-success btn-block m-t-md idxtLogin">Login</a>
												
												<!--<button type="_submit" class="btn btn-success btn-block">Login</button>-->
                                                <a href="forgot.html" class="display-block text-center m-t-md text-sm">Forgot Password?</a>
                                                <p class="text-center m-t-xs text-sm">Do not have an account?</p>
                                                <a href="register.html" class="btn btn-default btn-block m-t-md">Create an account</a>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- Row -->
                </div><!-- Main Wrapper -->
            </div><!-- Page Inner -->
        </main><!-- Page Content -->
	

        <!-- Javascripts -->
        <script src="//static.indextrade.exchange/js/jquery-2.2.4.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/jquery-ui/jquery-ui.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/pace-master/pace.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/jquery-blockui/jquery.blockui.js"></script>
        <script src="//static.indextrade.exchange/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/switchery/switchery.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/uniform/jquery.uniform.min.js"></script>
        <script src="//static.indextrade.exchange/plugins/classie/classie.js"></script>
        <script src="//static.indextrade.exchange/plugins/waves/waves.min.js"></script>
        <script src="//static.indextrade.exchange/js/modern.min.js"></script> 
		<script src="//static.indextrade.exchange/plugins/toastr/toastr.min.js"></script>
		
		<script>
			toastr.options.newestOnTop = true;
			toastr.options.preventDuplicates = false;
			toastr.options.timeOut = 3000; // How long the toast will display without user interaction
			toastr.options.extendedTimeOut = 3000;
			toastr.options.progressBar = true;
			
			$( document ).ready(function() {
				//проверить, может залогинен уже? 
				var _jwt = window.sessionStorage.getItem('IDXT-JWT');
				
				if (_jwt){
					//проверить нужно токен 
				}
				/*
				$.ajaxSetup({
					xhrFields: {
						withCredentials: true
					}
				});
				*/
				$('.idxtLogin').click(function(e){
					//e.preventDefault();
					
					var _email = $('.idxtRegisterEmail').val();
					var _passw = $('.idxtRegisterPassword').val();
					
					if (_email && _passw){
						$('.idxtForm').submit();
						
						$('.idxtRegisterEmail').attr('disabled', 'disabled');
						$('.idxtRegisterPassword').attr('disabled', 'disabled');
						$('.idxtLogin').attr('disabled', 'disabled');
						
						/**
						$.post('https://trade.indextrade.exchange/user/auth', 
							{
								'_' : new Date().getTime(),
								'email' : _email,
								'passw' : _passw								
							}, 
							function(d){
								if (d && d.status && d.status == 'OK'){
									var el = $('.idxtLogin');
										
										el.removeClass('btn-success');
										el.addClass('btn-info');
										
										el.html('Welcome, <b>' + d.data.name + '</b>');
										
									//window.sessionStorage.setItem('IDXT-JWT', d.data.token);
									
										el.unbind('click');
										
										el.prop('href', 'https://trade.indextrade.exchange/?_='+new Date().getTime());
									
										el.removeAttr('disabled');
									
									toastr.success('Success! Now you can login to trading', 'Login'); 
									
									//top.location = '/login.html?_=' + new Date().getTime();									
									//console.log( d.data );
								}
								else {
								
									$('.idxtRegisterEmail').removeAttr('disabled');
									$('.idxtRegisterPassword').removeAttr('disabled');
									$('.idxtLogin').removeAttr('disabled');
									
									if (d && d.status == 'ERROR' && d.error)
										toastr.error('<b>Error</b>: ' + d.error, 'Login');
									else
										toastr.error('Error while user auth', 'Login');
									
								}
							}, 
							'json'
						);
						*/
						
					}
					else
						toastr.error('Empty e-mail and/or password', 'Login');
					
				});				
				
			});		
		</script>
        
    </body>
</html>